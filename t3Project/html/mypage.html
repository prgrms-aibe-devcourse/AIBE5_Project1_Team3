<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€ - ì—¬ê¸°ì €ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/mypage.css">
    <link rel="stylesheet" href="../css/Aichatbot.css">
    <script src="../js/Ai.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#000',
                        accent: '#FF385C',
                        ai: '#8B5CF6',
                    }
                }
            }
        }
    </script>
    <style>
        .tab-indicator { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }
        .trip-card { transition: transform 0.2s; }
        .trip-card:active { transform: scale(0.98); }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #8B5CF6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Modal Scrollbar Customization */
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
</head>
<body class="bg-gray-50 pb-24">

    <!-- Header -->
    <div class="sticky top-0 left-0 w-full bg-white/90 backdrop-blur-md z-40 border-b border-gray-100 px-4 h-14 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <a href="index.html" class="text-gray-800 hover:text-black transition-colors">
                <i data-lucide="chevron-left" width="24"></i>
            </a>
            <h1 class="font-bold text-lg text-gray-900">ë§ˆì´í˜ì´ì§€</h1>
        </div>
        <button onclick="openProfileModal()" class="text-gray-500 hover:text-black">
            <i data-lucide="settings" width="20"></i>
        </button>
    </div>

    <!-- Profile Section -->
    <div class="bg-white px-6 py-8 mb-2">
        <div class="flex items-center gap-4">
            <div class="relative group cursor-pointer" onclick="openProfileModal()">
                <div class="w-20 h-20 rounded-full p-[2px] bg-gradient-to-tr from-accent to-purple-500">
                    <img id="profile-img" src="" class="w-full h-full rounded-full border-2 border-white bg-gray-100 object-cover" alt="Profile">
                </div>
                <div class="absolute bottom-0 right-0 bg-white p-1 rounded-full border border-gray-100 shadow-sm">
                    <i data-lucide="camera" width="12" class="text-gray-500"></i>
                </div>
            </div>
            <div class="flex-1">
                <h2 id="profile-name" class="text-xl font-black text-gray-900 leading-tight mb-1"></h2>
                <p id="profile-email" class="text-xs text-gray-400 mb-2"></p>
                <p id="profile-bio" class="text-sm text-gray-600 mb-3 line-clamp-1"></p>
                
                <button onclick="openProfileModal()" class="px-3 py-1.5 border border-gray-200 rounded-lg text-xs font-bold text-gray-600 hover:bg-gray-50 hover:border-black transition-all">
                    í”„ë¡œí•„ í¸ì§‘
                </button>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="flex justify-between mt-8 px-2">
            <div class="text-center w-1/3 border-r border-gray-100">
                <p class="text-xs text-gray-400 font-medium mb-1">ë‹¤ë…€ì˜¨ ì—¬í–‰</p>
                <p class="text-lg font-black text-gray-900" id="stat-trips">0</p>
            </div>
            <div class="text-center w-1/3 border-r border-gray-100">
                <p class="text-xs text-gray-400 font-medium mb-1">ë‚˜ì˜ í›„ê¸°</p>
                <p class="text-lg font-black text-gray-900" id="stat-reviews">0</p>
            </div>
            <div class="text-center w-1/3 cursor-pointer" onclick="switchTab('saved')">
                <p class="text-xs text-gray-400 font-medium mb-1">ì°œí•œ ì—¬í–‰</p>
                <p class="text-lg font-black text-accent" id="stat-likes">0</p>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="sticky top-14 bg-white z-30 border-b border-gray-100">
        <div class="flex relative">
            <button onclick="switchTab('trips')" class="tab-btn w-1/3 py-3 text-sm font-bold text-gray-400 transition-colors data-[active=true]:text-black" data-tab="trips">
                ë‚˜ì˜ ì—¬í–‰
            </button>
            <button onclick="switchTab('saved')" class="tab-btn w-1/3 py-3 text-sm font-bold text-gray-400 transition-colors data-[active=true]:text-black" data-tab="saved">
                ì°œí•œ ëª©ë¡
            </button>
            <button onclick="switchTab('reviews')" class="tab-btn w-1/3 py-3 text-sm font-bold text-gray-400 transition-colors data-[active=true]:text-black" data-tab="reviews">
                ë‚˜ì˜ í›„ê¸°
            </button>
            <div id="tab-line" class="absolute bottom-0 h-[2px] bg-black transition-all duration-300 w-1/3 left-0"></div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="max-w-3xl mx-auto px-4 py-6 min-h-[50vh]">

        <!-- Tab 1: My Trips -->
        <div id="tab-trips" class="tab-content active space-y-6">
            <div class="flex gap-3">
                <!-- Manual Create -->
                <div onclick="openCreateModal()" class="flex-1 bg-gray-900 rounded-2xl p-4 text-white flex flex-col justify-between cursor-pointer shadow-lg hover:bg-black transition-colors min-h-[100px] relative overflow-hidden group">
                    <div class="absolute right-[-10px] top-[-10px] opacity-10 group-hover:opacity-20 transition-opacity">
                        <i data-lucide="edit-3" width="60" height="60"></i>
                    </div>
                    <p class="text-[10px] text-gray-400 font-bold mb-1">ì§ì ‘ ë§Œë“¤ê¸°</p>
                    <div><p class="font-bold text-lg leading-tight">ë‚´ ë§˜ëŒ€ë¡œ<br>ì¼ì • ìƒì„±</p></div>
                    <div class="absolute bottom-4 right-4 bg-white/20 p-1 rounded-full"><i data-lucide="plus" width="14"></i></div>
                </div>

                <!-- AI Generate -->
                <div onclick="openAIModal()" class="flex-1 bg-gradient-to-br from-violet-600 to-indigo-600 rounded-2xl p-4 text-white flex flex-col justify-between cursor-pointer shadow-lg hover:shadow-xl transition-all min-h-[100px] relative overflow-hidden group">
                    <div class="absolute right-[-10px] top-[-10px] opacity-20 group-hover:opacity-30 transition-opacity animate-pulse">
                        <i data-lucide="sparkles" width="60" height="60"></i>
                    </div>
                    <p class="text-[10px] text-violet-200 font-bold mb-1">AI ìë™ ìƒì„±</p>
                    <div><p class="font-bold text-lg leading-tight">AIì—ê²Œ<br>ì¶”ì²œë°›ê¸°</p></div>
                    <div class="absolute bottom-4 right-4 bg-white/20 p-1 rounded-full"><i data-lucide="wand-2" width="14"></i></div>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">ë‹¤ê°€ì˜¤ëŠ” ì—¬í–‰ <span class="text-accent text-sm" id="upcoming-count">0</span></h3>
                <div id="upcoming-list" class="space-y-4"></div>
            </div>

            <div class="pt-6 border-t border-gray-100">
                <h3 class="font-bold text-gray-400 text-sm mb-4">ì§€ë‚œ ì—¬í–‰</h3>
                <div id="past-list" class="space-y-4 opacity-90"></div>
            </div>
        </div>

        <!-- Tab 2: Saved -->
        <div id="tab-saved" class="tab-content">
            <div id="saved-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
            <div id="saved-empty" class="hidden flex-col items-center justify-center py-20 text-gray-400">
                <i data-lucide="heart-off" width="48" class="mb-4 text-gray-200"></i>
                <p>ì•„ì§ ì°œí•œ ì—¬í–‰ì§€ê°€ ì—†ì–´ìš”.</p>
                <a href="index.html" class="mt-4 text-accent text-sm font-bold underline">ì—¬í–‰ì§€ ë‘˜ëŸ¬ë³´ê¸°</a>
            </div>
        </div>

        <!-- Tab 3: Reviews -->
        <div id="tab-reviews" class="tab-content">
             <div class="bg-blue-50 p-4 rounded-xl mb-6 flex items-start gap-3">
                <i data-lucide="info" class="text-blue-500 mt-0.5" width="16"></i>
                <p class="text-xs text-blue-800 leading-relaxed">
                    ì—¬í–‰ í›„ê¸°ë¥¼ ì‘ì„±í•˜ë©´ í¬ì¸íŠ¸ê°€ ì ë¦½ë©ë‹ˆë‹¤.<br>
                    ì‘ì„±í•œ í›„ê¸°ëŠ” ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>
            <div id="review-list" class="space-y-4"></div>
             <div id="review-empty" class="hidden text-center py-20 text-gray-400">ì‘ì„±í•œ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <!-- 1. Profile Edit Modal [NEW] -->
    <div id="profile-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeProfileModal()"></div>
        <div class="bg-white w-full max-w-md rounded-3xl p-6 z-10 relative animate-slide-up max-h-[85vh] overflow-y-auto modal-scroll">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">í”„ë¡œí•„ í¸ì§‘</h3>
                <button onclick="closeProfileModal()" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x" width="20"></i></button>
            </div>
            
            <div class="flex flex-col items-center mb-6">
                <div class="relative w-24 h-24 mb-3">
                    <img id="edit-profile-img" src="" class="w-full h-full rounded-full bg-gray-100 object-cover border border-gray-200">
                    <button type="button" onclick="refreshAvatar()" class="absolute bottom-0 right-0 bg-black text-white p-2 rounded-full shadow-lg hover:bg-gray-800 transition-colors" title="ëœë¤ ì´ë¯¸ì§€ ìƒì„±">
                        <i data-lucide="refresh-cw" width="14"></i>
                    </button>
                </div>
                <p class="text-xs text-gray-400">ì£¼ì‚¬ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•„ë°”íƒ€ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
            </div>

            <form onsubmit="saveProfile(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">ë‹‰ë„¤ì„</label>
                    <input type="text" id="edit-name" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none font-bold" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">í•œì¤„ ì†Œê°œ (ìƒíƒœ ë©”ì‹œì§€)</label>
                    <input type="text" id="edit-bio" placeholder="ë‚˜ë§Œì˜ ì—¬í–‰ ëª¨í† ë¥¼ ì ì–´ì£¼ì„¸ìš”." class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">ì´ë©”ì¼ (ë³€ê²½ ë¶ˆê°€)</label>
                    <input type="email" id="edit-email" class="w-full p-3 bg-gray-100 rounded-xl border border-transparent text-gray-400 cursor-not-allowed" readonly>
                </div>

                <button type="submit" class="w-full bg-black text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-colors mt-2">
                    ì €ì¥í•˜ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- 2. Manual Create/Edit Modal -->
    <div id="create-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeCreateModal()"></div>
        <div class="bg-white w-full max-w-md rounded-3xl p-6 z-10 relative animate-slide-up max-h-[85vh] overflow-y-auto modal-scroll">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black" id="create-modal-title">ìƒˆ ì¼ì • ë§Œë“¤ê¸°</h3>
                <button onclick="closeCreateModal()" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x" width="20"></i></button>
            </div>
            <form onsubmit="handleCreateOrUpdateTrip(event)" class="space-y-4">
                <input type="hidden" id="edit-trip-id">
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ì—¬í–‰ ì´ë¦„</label><input type="text" id="trip-title" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none font-bold" required></div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="block text-xs font-bold text-gray-500 mb-1">ì—¬í–‰ì§€</label><input type="text" id="trip-location" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none" required></div>
                    <div><label class="block text-xs font-bold text-gray-500 mb-1">ì˜ˆì‚° (ë§Œì›)</label><input type="number" id="trip-budget" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none"></div>
                </div>
                <div class="flex gap-3">
                    <div class="flex-1"><label class="block text-xs font-bold text-gray-500 mb-1">ì‹œì‘ì¼</label><input type="date" id="trip-start" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none text-sm" required></div>
                    <div class="flex-1"><label class="block text-xs font-bold text-gray-500 mb-1">ì¢…ë£Œì¼</label><input type="date" id="trip-end" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none text-sm" required></div>
                </div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ë™í–‰ì¸</label><input type="text" id="trip-companions" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ìƒì„¸ ê³„íš (ë©”ëª¨)</label><textarea id="trip-memo" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none h-24 resize-none"></textarea></div>
                <button type="submit" id="btn-save-trip" class="w-full bg-black text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-colors mt-2">ì¼ì • ì €ì¥í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <!-- 3. AI Create Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeAIModal()"></div>
        <div class="bg-white w-full max-w-md rounded-3xl p-6 z-10 relative animate-slide-up max-h-[85vh] overflow-y-auto modal-scroll">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-2"><i data-lucide="sparkles" class="text-violet-600" width="24"></i><h3 class="text-xl font-black bg-gradient-to-r from-violet-600 to-indigo-600 bg-clip-text text-transparent">AI ì—¬í–‰ ìƒì„±</h3></div>
                <button onclick="closeAIModal()" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x" width="20"></i></button>
            </div>
            <form onsubmit="handleAIGenerate(event)" class="space-y-5">
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ì–´ë””ë¡œ ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label><input type="text" id="ai-dest" class="w-full p-3 bg-violet-50 rounded-xl border border-violet-100 focus:border-violet-500 focus:outline-none font-bold text-violet-900" required></div>
                <div class="grid grid-cols-2 gap-3">
                     <div><label class="block text-xs font-bold text-gray-500 mb-1">ì—¬í–‰ ê¸°ê°„</label><select id="ai-duration" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none text-sm"><option value="1">ë‹¹ì¼ì¹˜ê¸°</option><option value="2">1ë°• 2ì¼</option><option value="3">2ë°• 3ì¼</option><option value="5">4ë°• 5ì¼ ì´ìƒ</option></select></div>
                     <div><label class="block text-xs font-bold text-gray-500 mb-1">ëˆ„êµ¬ì™€ í•¨ê»˜?</label><select id="ai-companion-type" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-black focus:outline-none text-sm"><option value="í˜¼ì">ğŸ§˜â€â™‚ï¸ í˜¼ì</option><option value="ì—°ì¸ê³¼">ğŸ’‘ ì—°ì¸ê³¼</option><option value="ì¹œêµ¬ì™€">ğŸ‘¯â€â™€ï¸ ì¹œêµ¬ì™€</option><option value="ê°€ì¡±ê³¼">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ê³¼</option></select></div>
                </div>
                <div><label class="block text-xs font-bold text-gray-500 mb-2">ì—¬í–‰ í…Œë§ˆ</label><div class="flex flex-wrap gap-2"><label class="cursor-pointer"><input type="radio" name="ai-theme" value="íë§" class="peer hidden" checked><span class="px-3 py-2 rounded-full border border-gray-200 text-xs font-bold text-gray-500 peer-checked:bg-violet-600 peer-checked:text-white peer-checked:border-violet-600 transition-all">ğŸŒ¿ íë§</span></label><label class="cursor-pointer"><input type="radio" name="ai-theme" value="ë§›ì§‘" class="peer hidden"><span class="px-3 py-2 rounded-full border border-gray-200 text-xs font-bold text-gray-500 peer-checked:bg-violet-600 peer-checked:text-white peer-checked:border-violet-600 transition-all">ğŸ” ë§›ì§‘íƒë°©</span></label><label class="cursor-pointer"><input type="radio" name="ai-theme" value="ì•¡í‹°ë¹„í‹°" class="peer hidden"><span class="px-3 py-2 rounded-full border border-gray-200 text-xs font-bold text-gray-500 peer-checked:bg-violet-600 peer-checked:text-white peer-checked:border-violet-600 transition-all">ğŸ„ ì•¡í‹°ë¹„í‹°</span></label></div></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ì˜ˆì‚° ìˆ˜ì¤€</label><div class="flex gap-3"><label class="flex-1 cursor-pointer"><input type="radio" name="ai-budget" value="ì•Œëœ°" class="peer hidden" checked><div class="p-3 rounded-xl border border-gray-200 text-center text-xs font-bold text-gray-500 peer-checked:bg-violet-100 peer-checked:text-violet-700 peer-checked:border-violet-500">ğŸ’° ì•Œëœ°</div></label><label class="flex-1 cursor-pointer"><input type="radio" name="ai-budget" value="ì ë‹¹íˆ" class="peer hidden"><div class="p-3 rounded-xl border border-gray-200 text-center text-xs font-bold text-gray-500 peer-checked:bg-violet-100 peer-checked:text-violet-700 peer-checked:border-violet-500">ğŸ’°ğŸ’° ì ë‹¹</div></label><label class="flex-1 cursor-pointer"><input type="radio" name="ai-budget" value="ëŸ­ì…”ë¦¬" class="peer hidden"><div class="p-3 rounded-xl border border-gray-200 text-center text-xs font-bold text-gray-500 peer-checked:bg-violet-100 peer-checked:text-violet-700 peer-checked:border-violet-500">ğŸ’°ğŸ’°ğŸ’° ëŸ­ì…”ë¦¬</div></label></div></div>
                <button type="submit" id="btn-ai-submit" class="w-full bg-gradient-to-r from-violet-600 to-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-violet-200 transition-all mt-4 flex justify-center items-center gap-2"><span>AI ë§ì¶¤ ì¼ì • ìƒì„±í•˜ê¸°</span></button>
            </form>
        </div>
    </div>

    <!-- 4. Review Write/Edit Modal -->
    <div id="review-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeReviewModal()"></div>
        <div class="bg-white w-full max-w-md rounded-2xl p-6 z-10 relative">
             <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold" id="review-modal-title">í›„ê¸° ì‘ì„±</h3><button onclick="closeReviewModal()" class="text-gray-400 hover:text-black"><i data-lucide="x" width="20"></i></button></div>
             <textarea id="review-text" class="w-full h-32 p-3 bg-gray-50 rounded-xl resize-none focus:outline-none mb-4" placeholder="ì—¬í–‰ì€ ì–´ë– ì…¨ë‚˜ìš”?"></textarea>
             <button onclick="submitReview()" id="btn-save-review" class="w-full bg-black text-white py-3 rounded-xl font-bold">ì‘ì„± ì™„ë£Œ</button>
        </div>
    </div>

    <!-- 5. Trip Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDetailModal()"></div>
        <div class="bg-white w-full max-w-md rounded-3xl p-6 z-10 relative animate-fade-in max-h-[85vh] overflow-y-auto modal-scroll">
             <div class="flex justify-between items-start mb-6"><h3 class="text-2xl font-black text-gray-900 leading-tight" id="view-title"></h3><button onclick="closeDetailModal()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-full"><i data-lucide="x" width="20"></i></button></div>
             <div class="space-y-6">
                 <div class="flex items-center gap-2 text-gray-600 bg-gray-50 p-3 rounded-xl"><i data-lucide="calendar" width="18"></i><span id="view-date" class="font-bold text-sm"></span></div>
                 <div class="grid grid-cols-2 gap-4"><div><p class="text-xs text-gray-400 font-bold mb-1">ì—¬í–‰ì§€</p><p id="view-location" class="font-bold text-gray-800"></p></div><div><p class="text-xs text-gray-400 font-bold mb-1">ë™í–‰ì¸</p><p id="view-companions" class="font-bold text-gray-800"></p></div><div><p class="text-xs text-gray-400 font-bold mb-1">ì˜ˆì‚°</p><p id="view-budget" class="font-bold text-gray-800"></p></div><div><p class="text-xs text-gray-400 font-bold mb-1">í…Œë§ˆ/íƒ€ì…</p><p id="view-theme" class="font-bold text-gray-800"></p></div></div>
                 <div><p class="text-xs text-gray-400 font-bold mb-2">ìƒì„¸ ì¼ì • ë° ë©”ëª¨</p><div id="view-memo" class="bg-gray-50 p-4 rounded-xl text-sm leading-relaxed text-gray-700 whitespace-pre-wrap h-auto min-h-[100px]"></div></div>
             </div>
             <button onclick="closeDetailModal()" class="w-full bg-black text-white py-3 rounded-xl font-bold mt-6">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- 6. Ai Chat Modal -->
    <button id="floating-chat-btn" onclick="toggleChatIframe()">ğŸ’¬</button>
    <div id="chat-frame-container">
        <iframe src="../Ai/AiChatbot.html" style="width:100%; height:100%; border:none;" scrolling="no"></iframe>
    </div>

    <!-- Data & Scripts -->
    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        // --- 1. Profile Logic [NEW] ---
        let currentAvatarSeed = 'Felix';
        const defaultProfile = {
            name: 'ì—¬í–‰í•˜ëŠ” ê¹€ì² ìˆ˜',
            email: 'traveler_kim@example.com',
            bio: 'ì—¬í–‰ì€ ë‚˜ë¥¼ ì°¾ëŠ” ì—¬ì •',
            avatarSeed: 'Felix'
        };

        function loadProfile() {
            const profile = JSON.parse(localStorage.getItem('userProfile')) || defaultProfile;
            
            document.getElementById('profile-name').textContent = profile.name;
            document.getElementById('profile-email').textContent = profile.email;
            document.getElementById('profile-bio').textContent = profile.bio;
            document.getElementById('profile-img').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${profile.avatarSeed}`;
            
            currentAvatarSeed = profile.avatarSeed;
        }

        function openProfileModal() {
            const profile = JSON.parse(localStorage.getItem('userProfile')) || defaultProfile;
            
            document.getElementById('edit-name').value = profile.name;
            document.getElementById('edit-email').value = profile.email;
            document.getElementById('edit-bio').value = profile.bio;
            document.getElementById('edit-profile-img').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${profile.avatarSeed}`;
            
            currentAvatarSeed = profile.avatarSeed;
            
            document.getElementById('profile-modal').classList.remove('hidden');
            document.getElementById('profile-modal').classList.add('flex');
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.add('hidden');
            document.getElementById('profile-modal').classList.remove('flex');
        }

        function refreshAvatar() {
            currentAvatarSeed = Math.random().toString(36).substring(7); // Random seed
            document.getElementById('edit-profile-img').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${currentAvatarSeed}`;
        }

        function saveProfile(e) {
            e.preventDefault();
            const newProfile = {
                name: document.getElementById('edit-name').value,
                email: document.getElementById('edit-email').value,
                bio: document.getElementById('edit-bio').value,
                avatarSeed: currentAvatarSeed
            };
            
            localStorage.setItem('userProfile', JSON.stringify(newProfile));
            loadProfile(); // Update UI
            closeProfileModal();
            alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // --- 2. Tab Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.dataset.tab === tabId;
                btn.dataset.active = isActive;
                btn.classList.toggle('text-black', isActive);
                btn.classList.toggle('text-gray-400', !isActive);
            });
            const line = document.getElementById('tab-line');
            if(tabId === 'trips') line.style.left = '0%';
            if(tabId === 'saved') line.style.left = '33.33%';
            if(tabId === 'reviews') line.style.left = '66.66%';
            document.querySelectorAll('.tab-content').forEach(content => { content.classList.remove('active'); });
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        // --- 3. Trips Logic ---
        function getTrips() { return JSON.parse(localStorage.getItem('myTrips') || '[]'); }
        function getMyReviews() { return JSON.parse(localStorage.getItem('myReviews') || '[]'); }

        function renderTrips() {
            const trips = getTrips();
            const reviews = getMyReviews();
            const upcomingList = document.getElementById('upcoming-list');
            const pastList = document.getElementById('past-list');
            const statTrips = document.getElementById('stat-trips');
            
            upcomingList.innerHTML = ''; pastList.innerHTML = '';
            const now = new Date();
            let upcomingCount = 0; let pastCount = 0;

            if (trips.length === 0) { upcomingList.innerHTML = `<div class="text-center py-10 text-gray-400 text-sm">ë“±ë¡ëœ ì—¬í–‰ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; }

            trips.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

            trips.forEach((trip, index) => {
                const start = new Date(trip.startDate);
                const end = new Date(trip.endDate); end.setHours(23, 59, 59);
                const isPast = end < now;
                const dDay = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
                const hasReview = reviews.some(r => r.tripId === trip.id);

                let actionButtonHtml = '';
                if (isPast) {
                    if (hasReview) {
                        actionButtonHtml = `<span class="px-3 py-1.5 bg-gray-100 text-gray-400 text-xs font-bold rounded-lg border border-gray-200">í›„ê¸° ì‘ì„±ì™„ë£Œ</span>`;
                    } else {
                        actionButtonHtml = `<button onclick="event.stopPropagation(); openCreateReviewModal('${trip.id}')" class="px-4 py-2 bg-gray-900 text-white text-xs font-bold rounded-lg hover:bg-black transition-colors">í›„ê¸° ì“°ê¸°</button>`;
                    }
                } else {
                    actionButtonHtml = `<div class="flex gap-1"><button onclick="event.stopPropagation(); openEditModal('${trip.id}')" class="p-2 bg-gray-100 rounded-full text-gray-500 hover:text-black hover:bg-gray-200 transition-colors"><i data-lucide="pencil" width="16"></i></button><button onclick="event.stopPropagation(); deleteTrip(${index})" class="p-2 bg-gray-100 rounded-full text-gray-500 hover:text-red-500 hover:bg-red-50 transition-colors"><i data-lucide="trash-2" width="16"></i></button></div>`;
                }
                
                const cardHtml = `<div onclick="openDetailModal('${trip.id}')" class="trip-card bg-white border border-gray-100 rounded-2xl p-5 shadow-sm flex justify-between items-center group relative overflow-hidden cursor-pointer hover:shadow-md"><div class="relative z-10"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold px-2 py-0.5 rounded bg-${isPast ? 'gray-100 text-gray-400' : 'red-50 text-accent'}">${isPast ? 'ì—¬í–‰ì™„ë£Œ' : (dDay <= 0 ? (dDay === 0 ? 'D-Day' : 'ì—¬í–‰ì¤‘') : `D-${dDay}`)}</span><span class="text-xs text-gray-400">${trip.startDate} ~ ${trip.endDate}</span></div><h4 class="font-bold text-lg text-gray-900 flex items-center gap-2">${trip.title} ${trip.isAI ? '<i data-lucide="sparkles" width="14" class="text-violet-500"></i>' : ''}</h4><p class="text-sm text-gray-500 flex items-center gap-1 mt-1"><i data-lucide="map-pin" width="12"></i> ${trip.location} <span class="text-xs text-gray-300">|</span> <span class="text-xs">${trip.companions || 'ë™í–‰ ë¯¸ì •'}</span></p></div><div class="relative z-10 flex flex-col items-end gap-2">${actionButtonHtml}</div></div>`;
                if (isPast) { pastList.innerHTML += cardHtml; pastCount++; } else { upcomingList.innerHTML += cardHtml; upcomingCount++; }
            });
            document.getElementById('upcoming-count').textContent = upcomingCount;
            statTrips.textContent = pastCount;
            lucide.createIcons();
        }

        function openDetailModal(tripId) {
            const trips = getTrips(); const trip = trips.find(t => t.id === tripId); if(!trip) return;
            document.getElementById('view-title').textContent = trip.title;
            document.getElementById('view-date').textContent = `${trip.startDate} ~ ${trip.endDate}`;
            document.getElementById('view-location').textContent = trip.location;
            document.getElementById('view-companions').textContent = trip.companions || '-';
            document.getElementById('view-budget').textContent = trip.budget ? `${trip.budget}ë§Œì›` : '-';
            document.getElementById('view-theme').textContent = trip.isAI ? 'AI ìƒì„±' : 'ì§ì ‘ ìƒì„±';
            document.getElementById('view-memo').textContent = trip.memo || 'ì‘ì„±ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
            document.getElementById('detail-modal').classList.remove('hidden'); document.getElementById('detail-modal').classList.add('flex');
        }
        function closeDetailModal() { document.getElementById('detail-modal').classList.add('hidden'); document.getElementById('detail-modal').classList.remove('flex'); }

        function openCreateModal() { 
            document.getElementById('create-modal-title').textContent = 'ìƒˆ ì¼ì • ë§Œë“¤ê¸°'; document.getElementById('btn-save-trip').textContent = 'ì¼ì • ì €ì¥í•˜ê¸°'; document.getElementById('edit-trip-id').value = '';
            document.querySelector('#create-modal form').reset(); document.getElementById('create-modal').classList.remove('hidden'); document.getElementById('create-modal').classList.add('flex');
        }
        function openEditModal(tripId) {
            const trips = getTrips(); const trip = trips.find(t => t.id === tripId); if(!trip) return;
            document.getElementById('create-modal-title').textContent = 'ì¼ì • ìˆ˜ì •í•˜ê¸°'; document.getElementById('btn-save-trip').textContent = 'ìˆ˜ì •ì™„ë£Œ'; document.getElementById('edit-trip-id').value = trip.id;
            document.getElementById('trip-title').value = trip.title; document.getElementById('trip-location').value = trip.location; document.getElementById('trip-start').value = trip.startDate; document.getElementById('trip-end').value = trip.endDate;
            document.getElementById('trip-budget').value = trip.budget || ''; document.getElementById('trip-companions').value = trip.companions || ''; document.getElementById('trip-memo').value = trip.memo || '';
            document.getElementById('create-modal').classList.remove('hidden'); document.getElementById('create-modal').classList.add('flex');
        }
        function closeCreateModal() { document.getElementById('create-modal').classList.add('hidden'); document.getElementById('create-modal').classList.remove('flex'); }
        function handleCreateOrUpdateTrip(e) {
            e.preventDefault(); let trips = getTrips(); const editId = document.getElementById('edit-trip-id').value;
            const tripData = { title: document.getElementById('trip-title').value, location: document.getElementById('trip-location').value, startDate: document.getElementById('trip-start').value, endDate: document.getElementById('trip-end').value, budget: document.getElementById('trip-budget').value, companions: document.getElementById('trip-companions').value, memo: document.getElementById('trip-memo').value, isAI: false };
            if(editId) { const index = trips.findIndex(t => t.id === editId); if(index !== -1) { trips[index] = { ...trips[index], ...tripData }; alert('ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); } } 
            else { trips.push({ id: Date.now().toString(), ...tripData }); }
            localStorage.setItem('myTrips', JSON.stringify(trips)); closeCreateModal(); renderTrips(); e.target.reset();
        }
        function deleteTrip(index) { if(confirm('ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { const trips = getTrips(); trips.splice(index, 1); localStorage.setItem('myTrips', JSON.stringify(trips)); renderTrips(); } }

        function openAIModal() { document.getElementById('ai-modal').classList.remove('hidden'); document.getElementById('ai-modal').classList.add('flex'); }
        function closeAIModal() { document.getElementById('ai-modal').classList.add('hidden'); document.getElementById('ai-modal').classList.remove('flex'); }
        function handleAIGenerate(e) {
            e.preventDefault(); const btn = document.getElementById('btn-ai-submit'); const originalText = btn.innerHTML;
            btn.disabled = true; btn.innerHTML = `<div class="loader"></div> <span class="ml-2">ìƒì„±ì¤‘...</span>`;
            const dest = document.getElementById('ai-dest').value; const theme = document.querySelector('input[name="ai-theme"]:checked').value; const duration = document.getElementById('ai-duration').value; const companionType = document.getElementById('ai-companion-type').value; const budgetType = document.querySelector('input[name="ai-budget"]:checked').value;
            const today = new Date(); const startDate = new Date(today); startDate.setDate(today.getDate() + 1); const endDate = new Date(startDate); endDate.setDate(startDate.getDate() + parseInt(duration));
            const aiMemo = `[AI ì¶”ì²œ ì½”ìŠ¤ - ${theme} í…Œë§ˆ]\n\n1ì¼ì°¨: ${dest} ë„ì°© í›„ ${theme} ëª…ì†Œ ë°©ë¬¸\n2ì¼ì°¨: ì˜¤ì „ ëœë“œë§ˆí¬ ê´€ê´‘, ì˜¤í›„ ììœ ì‹œê°„ (${budgetType} ì¶”ì²œ ì¹´í˜)\n${duration > 2 ? `3ì¼ì°¨: ${companionType} í•¨ê»˜í•˜ê¸° ì¢‹ì€ ì²´í—˜\n` : ''}\nğŸ’¡ íŒ: ${companionType} ì—¬í–‰ì€ ì—¬ìœ ë¡­ê²Œ!`;
            setTimeout(() => { const trips = getTrips(); trips.push({ id: Date.now().toString(), title: `AI ì¶”ì²œ: ${dest} ${theme} ì—¬í–‰`, location: dest, startDate: startDate.toISOString().split('T')[0], endDate: endDate.toISOString().split('T')[0], companions: companionType, budget: budgetType === 'ì•Œëœ°' ? '30' : (budgetType === 'ì ë‹¹íˆ' ? '60' : '150'), memo: aiMemo, isAI: true }); localStorage.setItem('myTrips', JSON.stringify(trips)); closeAIModal(); renderTrips(); btn.disabled = false; btn.innerHTML = originalText; document.getElementById('ai-dest').value = ''; alert(`AIê°€ ì¼ì •ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤!`); }, 2000);
        }

        // --- 4. Review & Saved Logic ---
        let currentReviewTripId = null; let editingReviewId = null;
        function renderReviews() {
            const reviews = getMyReviews(); const list = document.getElementById('review-list'); const empty = document.getElementById('review-empty'); const statReviews = document.getElementById('stat-reviews');
            statReviews.textContent = reviews.length; list.innerHTML = '';
            if(reviews.length === 0) { empty.classList.remove('hidden'); } else { empty.classList.add('hidden'); reviews.forEach(review => { list.innerHTML += `<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm animate-fade-in relative group"><div class="flex justify-between items-start mb-2"><h4 class="font-bold text-sm text-gray-900">${review.tripTitle}</h4><div class="flex items-center gap-2"><span class="text-xs text-gray-400">${review.date}</span><div class="flex gap-1 pl-2 border-l border-gray-100"><button onclick="openEditReviewModal(${review.id})" class="p-1 text-gray-400 hover:text-blue-500 transition-colors"><i data-lucide="pencil" width="14"></i></button><button onclick="deleteReview(${review.id})" class="p-1 text-gray-400 hover:text-red-500 transition-colors"><i data-lucide="trash-2" width="14"></i></button></div></div></div><p class="text-sm text-gray-600 line-clamp-3 leading-relaxed">${review.text}</p></div>`; }); lucide.createIcons(); }
        }
        function deleteReview(id) { if(confirm('ì •ë§ ì´ í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { let reviews = getMyReviews(); reviews = reviews.filter(r => r.id !== id); localStorage.setItem('myReviews', JSON.stringify(reviews)); renderReviews(); renderTrips(); } }
        function openCreateReviewModal(tripId) { currentReviewTripId = tripId; editingReviewId = null; document.getElementById('review-modal-title').textContent = 'í›„ê¸° ì‘ì„±'; document.getElementById('btn-save-review').textContent = 'ì‘ì„± ì™„ë£Œ'; document.getElementById('review-text').value = ''; document.getElementById('review-modal').classList.remove('hidden'); document.getElementById('review-modal').classList.add('flex'); }
        function openEditReviewModal(reviewId) { const reviews = getMyReviews(); const review = reviews.find(r => r.id === reviewId); if(!review) return; editingReviewId = reviewId; currentReviewTripId = review.tripId; document.getElementById('review-modal-title').textContent = 'í›„ê¸° ìˆ˜ì •'; document.getElementById('btn-save-review').textContent = 'ìˆ˜ì • ì™„ë£Œ'; document.getElementById('review-text').value = review.text; document.getElementById('review-modal').classList.remove('hidden'); document.getElementById('review-modal').classList.add('flex'); }
        function closeReviewModal() { document.getElementById('review-modal').classList.add('hidden'); document.getElementById('review-modal').classList.remove('flex'); }
        function submitReview() {
            const text = document.getElementById('review-text').value; if(!text) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            let reviews = getMyReviews();
            if (editingReviewId) { const index = reviews.findIndex(r => r.id === editingReviewId); if (index !== -1) { reviews[index].text = text; reviews[index].date = new Date().toLocaleDateString() + ' (ìˆ˜ì •ë¨)'; alert('í›„ê¸°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); } } 
            else { const trips = getTrips(); const trip = trips.find(t => t.id === currentReviewTripId); reviews.unshift({ id: Date.now(), tripId: currentReviewTripId, tripTitle: trip ? trip.title : 'ì‚­ì œëœ ì—¬í–‰', text: text, date: new Date().toLocaleDateString() }); }
            localStorage.setItem('myReviews', JSON.stringify(reviews)); closeReviewModal(); renderReviews(); renderTrips();
        }
        function renderSaved() {
            const favIds = JSON.parse(localStorage.getItem('favorites') || '[]'); const grid = document.getElementById('saved-grid'); const empty = document.getElementById('saved-empty'); const statLikes = document.getElementById('stat-likes'); statLikes.textContent = favIds.length; grid.innerHTML = '';
            if (favIds.length === 0) { empty.classList.remove('hidden'); empty.classList.add('flex'); } else { empty.classList.add('hidden'); empty.classList.remove('flex'); favIds.forEach(id => { if (typeof ARTICLES === 'undefined') return; const article = ARTICLES.find(a => a.id === id); if (!article) return; grid.innerHTML += `<div class="group relative rounded-xl overflow-hidden aspect-[4/3] cursor-pointer shadow-sm" onclick="location.href='article.html?id=${article.id}'"><img src="${article.imageUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"></div><div class="absolute top-2 right-2"><button onclick="event.stopPropagation(); removeFavoriteFromMyPage('${article.id}')" class="bg-white/20 backdrop-blur p-1.5 rounded-full text-white hover:bg-red-500 hover:text-white transition-colors"><i data-lucide="x" width="16"></i></button></div><div class="absolute bottom-3 left-3 text-white"><p class="text-[10px] font-bold opacity-80 mb-0.5">${article.category}</p><h4 class="font-bold text-sm leading-tight line-clamp-1">${article.title}</h4></div></div>`; }); }
        }
        function removeFavoriteFromMyPage(id) { toggleFavorite(id); renderSaved(); }

        window.addEventListener('DOMContentLoaded', () => {
            /*if (localStorage.getItem('isLoggedIn') !== 'true') { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.'); location.href = 'login.html'; return; }*/
            loadProfile(); // Load Profile Data
            renderTrips(); renderSaved(); renderReviews(); lucide.createIcons();
            const hash = window.location.hash.replace('#', ''); if(['trips', 'saved', 'reviews'].includes(hash)) switchTab(hash);
        });


    </script>
</body>
</html>