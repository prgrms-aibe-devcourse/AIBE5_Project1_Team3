<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—¬ê¸°ì €ê¸° : ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/auth.css">
</head>
<body class="bg-gray-50 h-screen flex items-center justify-center p-6">

    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl p-8 md:p-10 relative">
        <a href="login.html" class="absolute top-6 left-6 text-gray-400 hover:text-black">
            <i data-lucide="arrow-left" width="24"></i>
        </a>
        
        <div class="text-center mb-8">
            <h1 class="text-2xl font-black mb-2">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h1>
            <p class="text-gray-500 text-sm">ê°€ì…í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì‹œë©´<br>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
        </div>

        <form id="forgot-form" class="space-y-4">
            <div>
                <input id="reset-email" type="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" class="w-full px-4 py-3 rounded-xl bg-gray-50 border-gray-100 border focus:border-black focus:bg-white focus:outline-none transition-colors text-sm" required>
            </div>
            <!-- <button type="submit" id="btn-send" class="w-full py-3.5 bg-black text-white rounded-xl font-bold hover:bg-gray-800 transition-colors shadow-lg">
                ì¬ì„¤ì • ë©”ì¼ ë³´ë‚´ê¸°
            </button> -->
            <button type="submit" id="btn-send" 
                class="w-full py-3.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-colors shadow-lg">
                ì¬ì„¤ì • ë©”ì¼ ë³´ë‚´ê¸°
            </button>
        </form>
    </div>

    <!-- script.js ì—°ê²° í•„ìˆ˜ -->
    <script src="../js/script.js"></script>
    <script>
        const form = document.getElementById('forgot-form');
        const btn = document.getElementById('btn-send');

        // ë¦¬ë‹¤ì´ë ‰íŠ¸ URL ë™ì  ìƒì„± (ë¡œì»¬/ë°°í¬ í™˜ê²½ ìë™ ëŒ€ì‘)
        function getResetRedirectUrl() {
            const origin = window.location.origin;
            const path = window.location.pathname;
            // í˜„ì¬ í´ë” ê²½ë¡œì—ì„œ 'forgot-password.html'ì„ ë¹¼ê³  'reset-password.html'ì„ ë¶™ì„
            const basePath = path.substring(0, path.lastIndexOf('/'));
            return origin + basePath + '/resetPassword.html';
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            const supabase = window.supabaseClient;

            btn.disabled = true;
            btn.textContent = "ì „ì†¡ ì¤‘...";

            try {
                // Supabase ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡ ìš”ì²­
                const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: getResetRedirectUrl(), // ì¤‘ìš”: ë§í¬ í´ë¦­ ì‹œ ì´ë™í•  í˜ì´ì§€
                });

                if (error) throw error;

                showAuthModal("ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ", `${email}ë¡œ<br /> ì¸ì¦ ë§í¬ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤. <br/> ë©”ì¼í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”!`, "ğŸ“©");
                // í•„ìš” ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                // location.href = 'login.html'; 

            } catch (error) {
                showAuthModal("ì „ì†¡ ì‹¤íŒ¨", error.message, "âš ï¸");
            } finally {
                btn.disabled = false;
                btn.textContent = "ì¬ì„¤ì • ë©”ì¼ ë³´ë‚´ê¸°";
            }
        });
        
        if(window.lucide) lucide.createIcons();
    </script>
</body>
</html>